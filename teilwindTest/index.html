<!doctype html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Cosmos Analytics</title>
        <link rel="stylesheet" href="./style.css" />
    </head>
    <body>
        <div class="dashboard">
            <header>
                <h1>Cosmos Analytics</h1>
                <div class="controls" id="periodControls">
                    <button onclick="updateData('week')" class="active">
                        Неделя
                    </button>
                    <button onclick="updateData('month')">Месяц</button>
                </div>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Всего сегодня</div>
                    <div class="stat-value" id="todayCount">1,284</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Среднее время</div>
                    <div class="stat-value">2.4 мин</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Активные юзеры</div>
                    <div class="stat-value" id="activeUsers">42</div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-header">
                    <span>Активность сообщений</span>
                </div>
                <svg class="chart-svg" id="chart" viewBox="0 0 800 250">
                    <defs>
                        <linearGradient
                            id="barGradient"
                            x1="0"
                            y1="0"
                            x2="0"
                            y2="1">
                            <stop offset="0%" stop-color="var(--accent-neon)" />
                            <stop
                                offset="100%"
                                stop-color="var(--accent-purple)" />
                        </linearGradient>
                    </defs>
                    <g id="bars"></g>
                    <g id="labels"></g>
                </svg>
            </div>
        </div>

        <script>
            const data = {
                week: [
                    { day: "Пн", count: 120 },
                    { day: "Вт", count: 180 },
                    { day: "Ср", count: 150 },
                    { day: "Чт", count: 220 },
                    { day: "Пт", count: 280 },
                    { day: "Сб", count: 210 },
                    { day: "Вс", count: 160 },
                ],
                month: [
                    { day: "1-7", count: 850 },
                    { day: "8-14", count: 1100 },
                    { day: "15-21", count: 950 },
                    { day: "22-30", count: 1300 },
                ],
            };

            function updateData(period) {
                // Обновление кнопок
                document
                    .querySelectorAll(".controls button")
                    .forEach((btn) => btn.classList.remove("active"));
                event?.target.classList.add("active");

                const currentData = data[period];
                const svg = document.getElementById("bars");
                const labels = document.getElementById("labels");

                svg.innerHTML = "";
                labels.innerHTML = "";

                const maxCount = Math.max(...currentData.map((d) => d.count));
                const chartWidth = 800;
                const chartHeight = 200;
                const barWidth = (chartWidth / currentData.length) * 0.6;
                const spacing = chartWidth / currentData.length;

                currentData.forEach((d, i) => {
                    const barHeight = (d.count / maxCount) * chartHeight;
                    const x = i * spacing + (spacing - barWidth) / 2;
                    const y = chartHeight - barHeight;

                    // Создаем столбец
                    const rect = document.createElementNS(
                        "http://www.w3.org/2000/svg",
                        "rect",
                    );
                    rect.setAttribute("class", "bar");
                    rect.setAttribute("x", x);
                    rect.setAttribute("y", chartHeight); // Начинаем снизу для анимации
                    rect.setAttribute("width", barWidth);
                    rect.setAttribute("height", 0);

                    // Анимация высоты
                    setTimeout(() => {
                        rect.setAttribute("y", y);
                        rect.setAttribute("height", barHeight);
                    }, i * 50);

                    svg.appendChild(rect);

                    // Добавляем текст подписей
                    const text = document.createElementNS(
                        "http://www.w3.org/2000/svg",
                        "text",
                    );
                    text.setAttribute("class", "label-text");
                    text.setAttribute("x", x + barWidth / 2);
                    text.setAttribute("y", chartHeight + 30);
                    text.setAttribute("text-anchor", "middle");
                    text.textContent = d.day;
                    labels.appendChild(text);
                });

                // Эффект счетчика для цифр
                animateValue(
                    "todayCount",
                    1000,
                    currentData[currentData.length - 1].count * 5,
                    1000,
                );
            }

            function animateValue(id, start, end, duration) {
                const obj = document.getElementById(id);
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min(
                        (timestamp - startTimestamp) / duration,
                        1,
                    );
                    obj.innerHTML = Math.floor(
                        progress * (end - start) + start,
                    ).toLocaleString();
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            }

            // Инициализация при загрузке
            window.onload = () => updateData("week");
        </script>
    </body>
</html>
